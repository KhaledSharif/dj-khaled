# MusicGen Layered Production Configuration
song:
  name: "Electronic Symphony"
  output_file: "output/electronic_symphony.wav"
  sample_rate: 32000  # MusicGen default
  master_volume: 0.9
  
# Define reusable sections
sections:
  intro:
    start: 0
    duration: 8
    
  verse1:
    start: 8
    duration: 16
    
  chorus:
    start: 24
    duration: 16
    
  verse2:
    start: 40
    duration: 16
    
  bridge:
    start: 56
    duration: 8
    
  outro:
    start: 64
    duration: 8

# Define layers with timing, looping, and conditioning
layers:
  # Foundation layer - generated first, no conditioning
  - name: "drums"
    model: "facebook/musicgen-small"  # or "facebook/musicgen-medium", "facebook/musicgen-large"
    sections:
      - section: "intro"
        prompt: "minimal kick drum, atmospheric"
        volume: 0.5
        
      - section: "verse1"
        prompt: "steady drum beat with kick, snare, and hi-hats, 120 bpm"
        volume: 0.7
        loop: true  # Will loop if section is longer than generation
        
      - section: "chorus"
        prompt: "energetic drum pattern with fills, powerful kick"
        volume: 0.8
        
      - section: "verse2"
        prompt: "steady drum beat with kick, snare, and hi-hats, 120 bpm"
        volume: 0.7
        loop: true
        
      - section: "bridge"
        prompt: "building drum pattern, increasing tension"
        volume: 0.6
        
      - section: "outro"
        prompt: "fading drum pattern, sparse hits"
        volume: 0.4
        fade_out: true

  # Bass layer - conditioned on drums
  - name: "bass"
    model: "facebook/musicgen-small"
    condition_on: ["drums"]  # Will use drums as conditioning audio
    sections:
      - section: "verse1"
        prompt: "deep electronic bass line, following kick pattern"
        volume: 0.6
        start_offset: 2  # Start 2 seconds into the verse
        
      - section: "chorus"
        prompt: "powerful synth bass, side-chained to kick"
        volume: 0.7
        
      - section: "verse2"
        prompt: "deep electronic bass line, following kick pattern"
        volume: 0.6
        
      - section: "bridge"
        prompt: "ascending bass line, building energy"
        volume: 0.5
        
      - section: "outro"
        prompt: "sustained bass note, fading"
        volume: 0.3
        fade_out: true

  # Melody layer - conditioned on drums and bass
  - name: "lead_synth"
    model: "facebook/musicgen-melody"  # Better for melodic content
    condition_on: ["drums", "bass"]
    sections:
      - section: "intro"
        prompt: "atmospheric synth pad, ethereal"
        volume: 0.4
        
      - section: "verse1"
        prompt: "subtle synth arpeggio, minor key"
        volume: 0.5
        start_offset: 4
        
      - section: "chorus"
        prompt: "catchy synth melody, uplifting, major progression"
        volume: 0.8
        
      - section: "verse2"
        prompt: "subtle synth arpeggio variation, minor key"
        volume: 0.5
        
      - section: "bridge"
        prompt: "soaring synth lead, emotional climax"
        volume: 0.7
        
      - section: "outro"
        prompt: "gentle synth pad, resolution"
        volume: 0.4
        fade_out: true

  # Atmosphere layer - conditioned on all previous
  - name: "atmosphere"
    model: "facebook/musicgen-small"
    condition_on: ["drums", "bass", "lead_synth"]
    sections:
      - section: "intro"
        prompt: "ambient texture, vinyl crackle, reverb"
        volume: 0.3
        
      - section: "chorus"
        prompt: "background vocals, airy, ethereal harmonies"
        volume: 0.4
        
      - section: "bridge"
        prompt: "string section, orchestral swell"
        volume: 0.5
        
      - section: "outro"
        prompt: "fading reverb tail, ambient wash"
        volume: 0.3
        fade_out: true

# Processing options
processing:
  normalize: true  # Normalize final mix
  normalize_db: -14  # LUFS target for streaming platforms
  crossfade_duration: 0.1  # Seconds of crossfade between sections
  prevent_clipping: true
  
# Advanced options (optional)
advanced:
  generation_params:
    temperature: 1.0
    top_k: 250
    top_p: 0.0
    cfg_coef: 3.0  # Classifier free guidance
  
  # Cache generated sections for faster iteration
  use_cache: true
  cache_dir: "cache/electronic_symphony/"